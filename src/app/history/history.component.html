<!-- All anomalies that are fixed are shown here -->
<header class="flex items-center w-full sticky-top disable-touch-scroll space-x-4"
    style="background-color: #f0f3f9; width: 100%;">
    <div class="flex items-center max-w-17rem w-25vw relative p-2 h-full"
        style="background-image: linear-gradient(#6586c3c5 0,#6586c3c5 150%), url(../../assets/background-img.png)!important; background-repeat: no-repeat; background-size: cover; width: 25%;">
        <img class="h-14" src="../../assets/codiTrack-logo.png" alt="CodiTrack Logo">
        <h3 class="text-white m-0 ml-2 text-xl px-5">CodiTrack</h3>
    </div>
    <div class="col-span-6 bg-gray-100 pl-3 py-3 flex flex-nowrap my-auto">
        <div class="bg-gray-100 bg-opacity-75 w-32 h-12 rounded p-1 my-auto">
            <!-- <div class="flex items-center h-full"> -->
            <!-- <select
                    class="appearance-none bg-white border border-gray-300 py-2 px-4 leading-tight text-sm rounded-md"
                    name="country" id="" [(ngModel)]="selectedCountry">
                    <option class="text-base" value="all">All locations</option>
                    <option class="text-base" value="belgium">Belgium</option>
                    <option class="text-base" value="Luxembourg">Luxembourg</option>
                    <option class="text-base" value="france">France</option>
                    <option class="text-base" value="netherlands">Netherlands</option>
                </select> -->
            <!-- </div> -->
        </div>
        <div class="my-auto absolute right-3 top-3 flex flex-nowrap">
            <div (click)="changeMode()" class="my-auto mx-8">
                <button class="px-4 py-2 bg-[#6684be] text-white text-sm rounded float-left w-1/2">List</button>
                <button class="px-4 py-2 bg-gray-200 text-black text-sm rounded float-right w-1/2">Map</button>
            </div>

            <button class="px-3 py-2 bg-[#6684be] text-white rounded-md hover:bg-[#4f74ac] float-right my-auto"
                routerLink="/menu">
                <div class="ml-auto text-xl"><i class="fas fa-backward fa-xl"></i></div>
            </button>
        </div>
    </div>
</header>


<div *ngIf="showModal" class="absolute top-0 left-0 w-full h-full flex items-center justify-center z-10" (keydown.escape)="closeModal(false)">
    <div class="mx-auto bg-gray-200 w-96 p-4 px-8 rounded-lg border-black border border-1">
        <p>Id: {{modalAnomaly.id}}</p>
        <div class="mb-2">
            <img *ngIf="modalAnomaly.photo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Railroad_Tracks_-_Merritt_Island%2C_Florida.jpg/1200px-Railroad_Tracks_-_Merritt_Island%2C_Florida.jpg?20121011174007" alt="Anomaly Preview" class="max-w-full h-auto rounded-lg">
        </div>
        <p>Timestamp: {{modalAnomaly.timestamp.getDate()}} - {{(modalAnomaly.timestamp.getMonth()+1).toLocaleString('en-US', { minimumIntegerDigits: 2 })}} - {{modalAnomaly.timestamp.getFullYear()}}</p>

        <div class="flex flex-nowrap justify-center">
            <div class="flex flex-nowrap mr-5">
                <p class="my-auto mr-2">Fixed: </p>
                <div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" [(ngModel)]="modalAnomaly.isFixed" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>
    
            <div class="flex flex-nowrap">
                <p class="my-auto mr-2">False: </p>
                <div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" [(ngModel)]="modalAnomaly.isFalse" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>
        </div>

        <div class="flex flex-nowrap mt-2 justify-center">
            <button class="text-base mr-2 px-2 py-1 bg-[#6684be] text-white rounded-md hover:bg-[#4f74ac] float-right my-auto" (click)="closeModal(true)">Save</button>
            <button class="text-base mx-2 px-2 py-1 bg-[#6684be] text-white rounded-md hover:bg-[#4f74ac] float-right my-auto" (click)="closeModal(false)">Close</button>
        </div>
    </div>
</div>

<div class="flex m-0 p-0 mb-0 pb-0">
    <aside class="w-1/4 grid grid-cols-2">
        <div class="border border-solid border-gray-300">
            <div class="card-header bg-opacity-3 h-3rem text-sm p-2 mb-0 border-b border-solid border-gray-200"
                style="background-color: #f0f3f9;">
                Select railway asset
            </div>
            <div class="p-0  d-flex">
                <ul class="overflow-auto h-[87vh] d-inline-block text-xl">
                    <div *ngFor="let train of trains; let i = index" style="cursor:pointer"
                        class="relative block px-3 py-3 w-full text-dark bg-white border border-gray-300"
                        id="{{ train.id }}" (click)="onTrainClick(train.id)"
                        [style.backgroundColor]="selectedTrain === train.id ? '#4f74ac' : '#FFFFFF'"
                        [style.color]="selectedTrain === train.id ? '#FFFFFF' : '#000000'">
                        <i class="fas fa-train px-5 font-black"></i> <small> {{train.name}}</small>
                    </div>
                </ul>
            </div>
        </div>
        <div class="toggle-bar border border-black border-opacity-25" *ngIf="selectedTrain !== -1">
            <div class="card-header bg-opacity-3 h-3rem text-sm p-2 mb-0 border-b border-solid border-gray-200 mx-auto"
                style="background-color: #f0f3f9;"> Select date </div>
            <div class="p-2">
                <div class="mb-2">
                    <select
                        class="appearance-none bg-white border border-gray-300 py-2 px-4 leading-tight text-sm rounded-md my-auto"
                        id="filter-select" [(ngModel)]="selectedFilter">
                        <option value="" disabled>Select Date</option>
                        <option value="thisWeek">This week</option>
                        <option value="previousWeek">Previous week</option>
                        <option value="customRange">Custom range</option>
                    </select>

                </div>
                <div *ngIf="selectedFilter === 'customRange'" class="h-20 w-45">
                    <mat-form-field class="datepicker">
                        <mat-label>Enter a date range</mat-label>
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-input [rangePicker]="picker">
                          <input matStartDate placeholder="Start date" [(ngModel)]="rangeDates[0]">
                          <input matEndDate placeholder="End date" [(ngModel)]="rangeDates[1]">
                        </mat-date-range-input>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                      </mat-form-field>
                </div>
                <hr>
                <div id="day-list" class="list-group-scroll text-sm overflow-auto h-[69vh]">
                    <ng-container
                        *ngFor="let day of selectedFilter === 'thisWeek' ? getCurrentWeek() : selectedFilter === 'previousWeek' ? getPreviousWeek() : selectedFilter === 'customRange' ? getCustomRange() : []">
                        <div
                            *ngIf="selectedFilter === 'thisWeek' || selectedFilter === 'previousWeek' || selectedFilter === 'customRange' || selectedFilter === ''">
                            <a id="{{ day }}" style="cursor:pointer"
                                class="relative block px-2 py-2 w-full text-dark bg-white border border-gray-300"
                                [style.backgroundColor]="selectedDay === day ? '#4f74ac' : '#FFFFFF'"
                                [style.color]="selectedDay === day ? '#FFFFFF' : '#000000'" (click)="selectDay(day)">
                                <b>{{ day }}</b>
                            </a>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </aside>
    <div class="w-3/4">
        <div class="px-7">
            <div *ngFor="let track of sortedTracks">
                <ng-container *ngIf="getAnomaliesForTrack(track.id, selectedTrain, selectedDay).length > 0">
                  <app-anomaly-item [track]="track"
                    [anomalies]="getAnomaliesForTrack(track.id, selectedTrain, selectedDay)"
                    ></app-anomaly-item>
                </ng-container>
            </div>
        </div>
    </div>
</div>